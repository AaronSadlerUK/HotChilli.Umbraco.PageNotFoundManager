{"version":3,"file":"pagenotfound.modal.element-DAvG6IRv.js","sources":["../../hc.pagenotfoundmanager.client/src/Modals/pagenotfound.modal.element.ts"],"sourcesContent":["import { customElement, html, state } from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UmbModalBaseElement, UmbModalRejectReason } from \"@umbraco-cms/backoffice/modal\";\r\nimport type { UmbInputDocumentElement } from \"@umbraco-cms/backoffice/document\";\r\nimport { UmbDocumentItemRepository } from \"@umbraco-cms/backoffice/document\";\r\n\r\nimport { PageNotFoundModalData, PageNotFoundModalValue } from \"./pagenotfound.modal.token.ts\";\r\nimport { PageNotFoundManagerService } from \"../api/services.gen.ts\";\r\n\r\n@customElement('page-not-found-modal')\r\nexport class PageNotFoundModalElement extends UmbModalBaseElement<PageNotFoundModalData, PageNotFoundModalValue>\r\n{\r\n    @state()\r\n\tprivate _selection: string | undefined | null;\r\n\r\n    private _inherited404?: string;\r\n    private _inheritsFrom?: string;\r\n\r\n    @state()\r\n\tprivate _documentName = '';\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    async connectedCallback() {\r\n        super.connectedCallback();\r\n\r\n        if(!this.data?.entityKey){\r\n            // This is a problem\r\n            console.error(\"PNFM: connectedCallback. There is NO EntityKey passed into the modal\");\r\n        }\r\n\r\n        if(this.data?.target){\r\n            this._selection = this.data?.target?.explicit404;\r\n            if(this.data?.target?.inherited404?.explicit404)\r\n            {\r\n                this._inherited404 = await this.#getDocumentName(this.data?.target?.inherited404?.explicit404);\r\n                this._inheritsFrom = await this.#getDocumentName(this.data?.target?.inherited404?.pageId);\r\n\r\n                console.log(`inherits '${this._inherited404}' From:'${this._inheritsFrom}'`);\r\n            }\r\n        }\r\n\r\n        this._documentName = (await this.#getDocumentName(this.data?.entityKey)) ?? '';\r\n    }\r\n\r\n    private handleClose() {\r\n        this.modalContext?.reject({ type: \"close\" } as UmbModalRejectReason);\r\n    }\r\n\r\n    private async handleSave() {\r\n        var res = await PageNotFoundManagerService.postApiV1HcsSetNotFound(\r\n            {\r\n                requestBody: {\r\n                    parentId: this.data?.entityKey ?? \"\",\r\n                    notFoundPageId: this._selection\r\n                }\r\n            }\r\n        );\r\n\r\n        console.log(res);\r\n\r\n        this.value = {\r\n            currentNodeName: this._documentName,\r\n            selectedNodeName: await this.#getDocumentName(this._selection)\r\n        }\r\n        \r\n        this.modalContext?.submit();\r\n    }\r\n\r\n    private _getIntroductionMessage(){\r\n        if(this._selection)\r\n            return html`The current 404 page for <strong>${this._documentName}</strong> and child pages is show below.`;\r\n\r\n        return html`There is currently no 404 page explicitly set for <strong>${this._documentName}</strong>.`;\r\n    }\r\n\r\n    private _getInstructionMessage()\r\n    {\r\n        if(this._selection)\r\n            return html `To change the 404 page, click on the content selector below and pick the new 404 page.`;\r\n        return html`To <strong>set</strong> the 404 page, click on the content selector below and pick the new 404 page.`;\r\n    }\r\n\r\n    private _getInheritanceMessage()\r\n    {\r\n        if(!this._selection && this._inherited404)\r\n        {\r\n            return html`<p>This page currently inherits a 404 from an ancestor:<br><strong>${this._inherited404}</strong> inherited from ${this._inheritsFrom} </p>`;\r\n        }\r\n        return ``;\r\n    }\r\n\r\n    #selectionChanged(e: CustomEvent) {\r\n\t\tthis._selection = (e.target as UmbInputDocumentElement).selection[0];\r\n\t}\r\n\r\n    async #getDocumentName(entityKey: string | undefined | null) {\r\n\t\tif (!entityKey) return;\r\n\t\t// Should this be done here or in the action file?\r\n\t\tconst { data } = await new UmbDocumentItemRepository(this).requestItems([entityKey]);\r\n\t\tif (!data) return;\r\n\t\tconst item = data[0];\r\n\t\t//TODO How do we ensure we get the correct variant?\r\n\t\treturn item.variants[0]?.name;\r\n\r\n\t}\r\n\r\n    render() {\r\n        console.log(this.data);\r\n        return html`\r\n            <umb-body-layout headline=\"Page Not Found #BETA#\">\r\n                <uui-box headline=\"Configure the 404 page for: '${this._documentName}'\">\r\n                    <p>${this._getIntroductionMessage()}</p>\r\n                    ${this._getInheritanceMessage()}\r\n\r\n                    <div>\r\n                        <p>${this._getInstructionMessage()}</p>\r\n                        <label>Selected 404 Page:</label>\r\n                        <umb-input-document min=1 max=1\r\n                            .value=${this._selection}\r\n                            @change=${this.#selectionChanged}>\r\n                        </umb-input-document>\r\n                    </div>\r\n                </uui-box>\r\n                                \r\n                <div slot=\"actions\">\r\n                    <uui-button look=\"primary\" color=\"positive\" id=\"saveAndClose\" label=\"Close\" @click=\"${this.handleSave}\">Save & Close</uui-button>\r\n                    <uui-button look=\"primary\" color=\"danger\" id=\"close\" label=\"Close\" @click=\"${this.handleClose}\">Close</uui-button>\r\n                </div>\r\n            </umb-body-layout>\r\n        `;\r\n    }\r\n}\r\n\r\nexport default PageNotFoundModalElement;"],"names":["_PageNotFoundModalElement_instances","selectionChanged_fn","getDocumentName_fn","PageNotFoundModalElement","UmbModalBaseElement","__privateAdd","_a","_b","_d","_c","_g","_f","_e","__privateMethod","_j","_i","_h","_m","_l","_k","_n","res","PageNotFoundManagerService","html","entityKey","data","UmbDocumentItemRepository","__decorateClass","state","customElement","PageNotFoundModalElement$1"],"mappings":"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"}